# MP3 플레이어 앱 개발

## 1. 프로젝트 개요

본 프로젝트의 목표는 안드로이드 스마트폰에 저장된 MP3 파일들을 탐색하고, 목록으로 표시하며, 사용자가 선택한 곡을 재생하고 가사를 관리하는 MP3 플레이어 애플리케이션을 개발하는 것입니다.

**모든 핵심 기능이 구현된 동작 가능한 프로토타입이 성공적으로 완성되었습니다.**

### 핵심 기능
- 로컬 저장소의 오디오 파일 스캔 및 목록 표시
- 음악 재생 및 백그라운드 재생 지원
- 재생 컨트롤 UI (재생/일시정지, 이전/다음, 탐색 바)
- 사용자 지정 가사 등록, 저장, 보기 기능

## 2. 최종 개발 결과

### 완료된 기능
- **기본 아키텍처 설정**: ViewModel, Repository 패턴을 사용한 데이터 관리 구조 수립
- **파일 접근 권한**: 앱 실행 시 `READ_MEDIA_AUDIO` 권한 요청 및 처리
- **음악 파일 스캔**: `MediaStore`를 사용한 오디오 파일 스캔 및 강제 스캔 기능 구현
- **음악 목록 UI**: Jetpack Compose의 `LazyColumn`과 `Card`, 아이콘을 사용한 세련된 목록 UI 구현
- **백그라운드 재생**: `Media3 ExoPlayer`와 `Foreground Service`를 이용한 안정적인 백그라운드 재생 환경 구축 (시스템 알림 포함)
- **화면 전환**: Jetpack Navigation을 사용한 음악 목록 ↔ 현재 재생 ↔ 가사 편집 화면 간 전환
- **현재 재생 화면**: 곡 정보, 탐색 바(Seek bar), 아이콘 기반의 재생/일시정지, 이전/다음 컨트롤 버튼 기능 구현
- **가사 저장**: `Room` 데이터베이스를 설정하여 곡별 가사를 저장하는 기능 구현
- **가사 관리 UI**: 현재 재생 화면에서의 가사 보기 및 별도 화면에서의 가사 편집/저장 UI 구현

### 추후 개선 아이디어
- **알림창 컨트롤 개선**: 알림창에 이전/다음 버튼 등 추가 컨트롤 구현
- **재생 목록 관리**: 대기열(Queue) 관리, 재생 목록 편집 기능 추가
- **고급 기능**: 앨범 아트 표시, 잠금 화면 컨트롤, 가사 스크롤 동기화 등

### 2025-11-26 리팩토링 및 개선 사항
- **성능 개선 (목록 로딩)**: `ViewModel`에 음악 목록을 캐시하여, 목록 화면에 재진입할 때마다 발생하던 불필요한 전체 미디어 스캔을 제거하고 초기 로딩 속도를 크게 향상시켰습니다.
- **재생 제어 기능 구현**:
  - `MediaController`에 단일 곡이 아닌 전체 재생 목록을 전달하여 '다음 곡/이전 곡' 기능이 정상 작동하도록 수정했습니다.
  - `ExoPlayer`의 `repeatMode` 설정을 통해 한 곡 재생이 끝나면 자동으로 다음 곡이 재생되도록 구현했습니다.
- **UI 문제 해결**:
  - **긴 제목**: Jetpack Compose의 `basicMarquee`를 적용하여 긴 곡 제목이 자연스럽게 스크롤되도록 처리했습니다.
  - **긴 가사**: 가사 영역에 `verticalScroll`을 적용하여 내용이 길어도 전체를 볼 수 있도록 수정했습니다.
- **곡 길이 표시 오류 수정**: `Player.Listener`의 `onMediaMetadataChanged` 콜백 시점에 곡의 길이를 가져오도록 로직을 변경하여, 재생 화면 진입 시 발생하던 시간 표시 오류를 해결했습니다.
- **현재 재생 화면 복귀**: `MediaSession`에 `PendingIntent`를 설정하여, 시스템 상단 바의 미디어 알림을 탭하면 앱의 현재 재생 화면으로 바로 이동하도록 사용자 경험을 개선했습니다.
